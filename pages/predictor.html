<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Include this on every page -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="/js/include.js"></script>
    <link href="/css/main/main.css" rel='stylesheet'>
    <link href="/css/more/more.css" rel='stylesheet'>
    <link rel='icon' href="/assets/favicon.png" type="image/png">
    <script src="https://kit.fontawesome.com/3aa210e078.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tensorflow/rfjs@0.11.2"></script> -->
    
    <script>
async function returnData() {
    console.log('Running model...')

    // Load model
    const model = await tf.loadLayersModel('other/prediction/model.json');
            //file needs to be hosted directly from a server for it to run 
            //When the tensor is outputted correctly once a correct model is loaded from a server.
            //sample model for testing: https://hkinsley.com/static/tfjsmodel/model.json
            //If localhost//5500 does not detect, try running from https-server -c1 --cors . in your commandline


    // Load data
    var nroom = $('#nroom').val();// || 10;
    var sfoot = $('#sfoot').val(); //|| 1656;
    var lspace = $('#lspace').val();// || 1656; 


    // [Green living area, Total number of rooms above basement, 1st Floor Square Footage]
    var userData = [lspace,nroom,sfoot];     
    console.log("Using user data", userData);

    // Format inputs
    input_initial = tf.tensor(userData,[1,3],'float32');
    input = input_initial.log(); // Normalizing the data
    var readable_input = input.dataSync()
    console.log("HERE IS THE MODEL INPUT", readable_input);

    // Create prediction
    prediction = model.predict(input,'float32'); 
    var readable_pred = prediction.dataSync()
    console.log("HERE IS THE MODEL DATA OUTPUT", readable_pred);

    // Un-normalize outputs
    output = tf.exp(prediction);

    // Log predictions
    $('#epic').text(prediction)
    //console.log("Before exponent", prediction);
    //console.log('We got the output', output);
    
}
_.defer(returnData); 

    </script>    
    
    <!-- Include this on every page -->
    <title>Housing Price Predictor</title>

</head>

<body>
    <header data-load="templates/header.html">
    </header>
    <div class="container-fluid predictor background-image d-flex justify-content-center align-items-center text-center">
        <div class="header-text">
            <h1 class="display-4">Housing Price Predictor</h1>
            <p class="lead">Predict the value of your home</p>
        </div>
    </div>
    <div class="container" style = "padding-bottom: 300px;">
        <div class="text-center"> Photo Credit: “Peter Pichler Architecture Designs Sustainable Tree Houses in a Wild
            Forest of West Virginia.” World Architecture Community,
            https://worldarchitecture.org/article-links/eehvh/peter-pichler-architecture-designs-sustainable-tree-houses-in-a-wild-forest-of-west-virginia.html.
            Accessed 26 Jan. 2020. </div>

            
         


        <hr>
        <form>
            <div id="epic"></div>
            <div class="form-group">
                <label for="lspace">Green Living Space, e.g. size of yard</label>
                <input type="number"  class="form-control" id="lspace" placeholder="1000 (ft^2)">
            </div>
            
            
            <div class="form-group">
            
                <label for="sfoot">Square Footage (Above basement)</label>
                <input type="number"  class="form-control" id="sfoot" placeholder="2000 (ft^2)">
            </div>      

            <div class="form-group">
                <label for="nroom">Number of Rooms (Above basement)</label>
                <input type="number" class="form-control" id="nbath" placeholder="1">
            </div>


                <!-- <button type="submit" class="btn btn-primary mt-2">Submit</button> -->
                <!-- <button type="submit" class="btn btn-primary mt-2">Submit</button> -->
                <button class="btn btn-primary mt-2" onclick = "returnData()"> Return value </button>
                <p id = 'v'></p>
                 
        </form>


    </div>

    <footer>
        <div style="background-image: linear-gradient(rgba(0,0,0,.6), rgba(0,0,0,.6)), url('/assets/earth.jpg'); 
        background-size: cover; height: 150px; background-position: center;" class="d-flex flex-row align-items-center justify-content-center">
            <a class="btn btn-lg text-white" style="background: rgb(20, 7, 97)" href="/pages/finder.html"> Find Nearby Architects to Build Your Bio-home </a>
        </div>
        <div data-load="templates/footer.html">
        </div>
    </footer>


<script>
// function getValue(){
   
//     import * as tf from '@tensorflow/tfjs-node' //importing the tensorflow

//     var grn_liv = parseInt(document.getElementById("lspace").value); //getting the green living space
//     var first_footage = parseInt(document.getElementById("sfoot").value); //getting the 1st square 
     
//     var bedrooms = parseInt(document.getElementById("nbed").value);
//     var bathrooms = parseInt(document.getElementById("nbath").value);
//     var other_rooms = parseInt(document.getElementById("n_otherrooms").value);

//     var rooms = bedrooms + bathrooms + other_rooms; //getting the rooms

//     //document.getElementById("v").innerHTML = parseInt(document.getElementById("lspace").value) + parseInt(document.getElementById("sfoot").value);




//     //muy importante
//     const model = await tf.loadLayersModel('   #Insert filepath on webserver here#   /model.json'); //need to upload the model.json to server and then use link
//     //muy importante
    

//     input_initial = tf.tensor( [grn_liv, rooms, first_footage] , [1,3], 'float64');  //[1,3] and 'float64' are constant do not change.
//     input = tf.math.log(input_initial);

//     prediction = model.predict(  tf.tensor2d(input)  );
//     output = tf.math.exp(prediction);


//     document.getElementById("v").innerHTML = rooms2;
// }
//getValue();
</script>    



</body>

</html>